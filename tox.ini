[tox]
envlist = py35,py36,py37,flake8,integ-jobs

skip_missing_interpreters = False
ignore_basepython_conflict = True

[flake8]
max-line-length = 120
exclude =
    build/
    .git
    __pycache__
    .tox
    venv/
    tests/
    doc/

max-complexity = 10

ignore =
    C901,
    E203,  # whitespace before ':': Black disagrees with and explicitly violates this.
    FI10,
    FI11,  # __future__ import absolute_import is redundant for Python versions we are targeting
    FI12,
    FI13,
    FI14,
    FI15,
    FI16,
    FI17,
    FI18,  # __future__ import "annotations" missing -> check only Python 3.7 compatible
    FI50,
    FI51,
    FI52,
    FI53,
    FI54,
    FI55,
    FI56,
    FI57,
    W503

require-code = True

[testenv]
passenv =
    AWS_ACCESS_KEY_ID
    AWS_SECRET_ACCESS_KEY
    AWS_SESSION_TOKEN
    AWS_CONTAINER_CREDENTIALS_RELATIVE_URI
    AWS_DEFAULT_REGION
    SAGEMAKER_ENDPOINT

# {posargs} can be passed in by additional arguments specified when invoking tox.
# Can be used to specify which tests to run, e.g.: tox -- -s
commands =
    coverage run --source smexperiments -m pytest {posargs}
    {env:IGNORE_COVERAGE:} coverage html  --fail-under=90
extras = test
deps =
    boto3
    python-dateutil
    pytest
    pytest-cov
    docker

[testenv:flake8]
basepython = python3
skipdist = true
skip_install = true
deps =
    flake8
    flake8-future-import
commands = flake8

[testenv:sphinx]
basepython = python3
changedir = doc
install_command = python -m pip install --upgrade -I {packages}
deps =
    Pygments==2.2.0
    setuptools<40
    docutils==0.13.1
    mock==1.0.1
    pillow==2.6.1
    alabaster>=0.7,<0.8,!=0.7.5
    commonmark==0.5.4
    recommonmark==0.4.0
    sphinx<1.8
    sphinx-rtd-theme<0.5
    readthedocs-sphinx-ext<0.6

commands =
    #pip install --exists-action=w
    sphinx-build -T -W -b html -d _build/doctrees-readthedocs -D language=en . _build/html